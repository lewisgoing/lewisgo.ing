---
title: 'Chinese Remainder Theorem, Carnival Games and 2048-bit Integers'
description: "Guessing a 617-digit integer using ancient math! A journey through number theory, carnival games, and cryptography in AmateursCTF 2023."
date: '2023-07-24'
tags: ['programming', 'algorithm', 'number-theory', 'ctf']
status: 'completed'
completedDate: 'July 2023'
technologies: ['Python', 'Number Theory', 'Cryptography', 'CTF']
category: 'research'
featured: true
githubUrl: 'https://github.com/yourusername/crt-solver'
---

## Introduction

High school CTF team [View Source](https://ctftime.org/team/175828) and I participated in [AmateursCTF 2023](https://ctftime.org/event/1983), placing 2nd both overall and in the student division. Although there were over 64 challenges to tackle throughout the four-day submission period, I personally only put emphasis on the OSINT and algorithm categories. Within these categories lay an interesting challenge: the `gcd-query` series, which I solved with an implementation of a very special algorithm. This was my process (paired alongside a lengthy analogy)!

---

## gcd-query-v1

<Challenge
  authors={['skittles1412']}
  solvers={[
    {
      name: 'enscribe',
      href: 'https://github.com/jktrn'
    },
  ]}
  category="PPC"
  points={475}
  solves={43}
>
  I wonder if this program leaks enough information for you to get the flag with
  less than 2048 queries... It probably does. I'm sure you can figure out how.
  `nc amt.rs 31692`
</Challenge>

We're initially provided with an attachment `main.py` and a remote server `amt.rs:31692`. The server component contains the following:

Let's go over step-by-step what this server is up to:

- For ten iterations, a long `x` is created by pycrypto's [`getRandomInteger(n)`](https://pythonhosted.org/pycrypto/Crypto.Util.number-module.html#getRandomInteger), which returns a random integer with up to $n$ bits in length. $n = 2048$; this is an absolutely mindbendingly large numberâ€”up to 617 digits long! You absolutely do not want to see what 617 digits looks like in decmimal:



- For each iteration of `x`, the user gets prompted to enter two integers `n` and `m`. Once the assertion that `m > 0` is passed, `n` and `m` are passed into a function `gcd(x + n, m)`, which returns the **greatest common divisor** of `x + n` and `m`. This occurs for 1412 iterations.
- After the iterations have completed, the user is then prompted to guess the value of `x`. If the guess is correct, the next iteration of `x` begins. This process is repeated nine more times until the flag is printed.

Here is a quick visual depicting what's going on:

Paying close attention to the right side of this graphic, we can see that there's only a couple specific points at which we can interact with the server: when we pick the `n` and `m` to send, and when we guess the value of `x`. The question now is: what values should we be picking for `n` and `m` which reveal the most information about `x`, and how do we use this information to obtain its actual value?

### The Chinese Remainder Theorem
